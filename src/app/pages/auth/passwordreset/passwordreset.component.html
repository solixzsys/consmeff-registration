<p-toast></p-toast>

<div class="passwordreset-wrapper">
  <div class="passwordreset-container">
    <!-- Dark Mode Toggle -->
    <!-- <button class="dark-mode-toggle" (click)="toggleDarkMode()" type="button">
      <i class="pi" [ngClass]="isDarkMode ? 'pi-sun' : 'pi-moon'"></i>
    </button> -->

    <div class="passwordreset-card-container">
      <!-- Gradient blur effect -->
      <div class="gradient-blur"></div>
      
      <!-- Card -->
      <div class="passwordreset-card">
        <!-- Header Section -->
        <div class="header-section">
          <div class="logo-container">
            <div class="logo-circle">
              <img src="../../../assets/logo.png" alt="School Logo" class="logo-image" />
            </div>
          </div>
          <h1 class="title">Input One-Time Password (OTP)</h1>
          <p class="subtitle">A verification code was sent to {{ email }}</p>
        </div>

        <!-- Form -->
        <form class="passwordreset-form" [formGroup]="otpForm">
          <!-- OTP -->
          <div class="form-group">
            <p-floatLabel>
              <input
                pInputText
                id="otp"
                type="text"
                maxlength="6"
                formControlName="otp"
                class="w-full"
                [ngClass]="{
                  'ng-invalid ng-dirty': otp.touched && otp.invalid
                }"
              />
              <label for="otp">OTP</label>
              <i *ngIf="otp.valid && otp.value" class="pi pi-check-circle success-icon"></i>
            </p-floatLabel>
            <small *ngIf="otp.touched && otp.invalid" class="p-error">
              Please enter a valid 6-digit OTP
            </small>
          </div>

          <!-- Password -->
          <div class="form-group">
            <p-floatLabel>
              <p-password
                inputId="password"
                formControlName="password"
                [toggleMask]="true"
                [feedback]="false"
                styleClass="w-full password-field"
                inputStyleClass="w-full"
                [ngClass]="{
                  'ng-invalid ng-dirty': password.touched && password.invalid
                }"
              ></p-password>
              <label for="password">Password</label>
              <i *ngIf="password.valid && password.value" class="pi pi-check-circle success-icon password-success"></i>
            </p-floatLabel>
            <small *ngIf="password.touched && password.invalid" class="p-error d-block mt-2">
              Password is required
            </small>
          </div>

          <!-- Password Validation Card -->
          <div class="validation-card" *ngIf="password.value">
            <p-card>
              <div class="validation-items">
                <div *ngFor="let item of validationCheck" class="validation-item">
                  <i class="pi" [ngClass]="item.status ? 'pi-check-circle check-valid' : 'pi-times-circle check-invalid'"></i>
                  <span [ngClass]="item.status ? 'text-valid' : 'text-invalid'">
                    {{ item.title }}
                  </span>
                </div>
              </div>
            </p-card>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <p-floatLabel>
              <p-password
                inputId="cpassword"
                formControlName="cpassword"
                [toggleMask]="true"
                [feedback]="false"
                styleClass="w-full password-field"
                inputStyleClass="w-full"
                [ngClass]="{
                  'ng-invalid ng-dirty': cpassword.touched && cpassword.value !== password.value
                }"
              ></p-password>
              <label for="cpassword">Confirm Password</label>
              <i *ngIf="cpassword.value && cpassword.value === password.value" class="pi pi-check-circle success-icon password-success"></i>
            </p-floatLabel>
            <small *ngIf="cpassword.touched && cpassword.value !== password.value" class="p-error d-block mt-2">
              Passwords do not match
            </small>
          </div>

          <!-- Submit Button -->
          <p-button
            label="Reset Password"
            icon="pi pi-lock"
            [loading]="busy"
            [disabled]="otpForm.invalid || busy"
            (onClick)="resetPass()"
            styleClass="w-full submit-button"
          ></p-button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Success Dialog -->
<p-dialog
  header="Password Reset Successful"
  [(visible)]="visible"
  [modal]="true"
  [closable]="false"
  [style]="{ width: '400px' }"
  styleClass="success-dialog"
>
  <div class="dialog-content">
    <p class="dialog-message">
      Your password has been successfully reset. You can now log in with your new password.
    </p>
    
    <div class="status-logo">
      <img width="70%" src="../../../assets/statuslogo.png" alt="Success" />
    </div>
    
    <p-button
      label="Login"
      icon="pi pi-sign-in"
      (onClick)="toLogin()"
      styleClass="w-full dialog-button"
    ></p-button>
    
    <p class="support-message">
      If you didn't request this reset, please contact <span class="support-link">support</span> immediately.
    </p>
  </div>
</p-dialog>